<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../public/css/public.css" />
    <link rel="stylesheet" href="../public/css/uz-common.css" />
    <link rel="stylesheet" href="../home/css/home-common.css" />
    <link rel="stylesheet" href="../public/css/plug/flatpickr.min.css">
    <link rel="stylesheet" href="../public/css/plug/jquery.Jcrop.min.css">
</head>

<body>
    <div class="u-head">
        <div class="min-width"></div>
    </div>
    <div class="u-content">
        <div class="uc-title min-width cf">
            <span class="my-center">个人中心</span>
            <div class="ui breadcrumb uc-bread">
                <a class="section">个人中心</a>
                <div class="divider"> &gt; </div>
                <a class="section">个人资料</a>
            </div>
        </div>
        <div class="uc-conbox cf min-width">
            <div class="conbox-l">
                <ul class="">
                    <li class="list-name"><a href="javascript:void(0)">我的订单</a></li>
                </ul>
                <ul>
                    <li class="list-name"><a href="javascript:void(0)">个人资料</a></li>
                    <li><a href="javascript:;" class="active">设置头像</a></li>
                    <li><a href="javascript:;">收货地址</a></li>
                </ul>
                <ul>
                    <li class="list-name"><a href="javascript:void(0)">安全认证</a></li>
                    <li><a href="javascript:;">邮箱绑定</a></li>
                    <li><a href="javascript:;">密码修改</a></li>
                    <li><a href="javascript:;">实名认证</a></li>
                </ul>
                <ul class="ul-active">
                    <li class="list-name"><a href="javascript:void(0)">账户管理</a></li>
                    <li><a href="javascript:;" class="active">交易明细</a></li>
                    <li><a href="javascript:;">银行卡设置</a></li>
                </ul>
                <ul>
                    <li class="list-name"><a href="javascript:void(0)">我的收藏</a></li>
                </ul>
                <ul>
                    <li class="list-name"><a href="javascript:void(0)">我的评价</a></li>
                </ul>
                <ul>
                    <li class="list-name"><a href="javascript:void(0)">我的短消息</a></li>
                </ul>
            </div>
            <div class="content-r">
                <div class="info-area">
                    <div class="ui header"><i class="icon user focus-color"></i>个人资料</div>
                    <div class="forms ui form">
                        <form action="" id="user-basic-info">
                            <dl class="required field">
                                <dt>
                                    <label for="username">用户名：</label>
                                </dt>
                                <dd>
                                    <input type="text" name="username" placeholder="1385642156" class="inputwidth">
                                    <div class="ui left pointing basic red mini label none">请输入用户名。</div>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="nickname">昵称：</label>
                                </dt>
                                <dd>
                                    <input type="text" name="nickname" placeholder="Oliver" class="inputwidth">
                                    <div class="ui left pointing basic red mini label none">该昵称已经存在。</div>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="location">所在城市：</label>
                                </dt>
                                <dd id="location_select">
                                    <select class="level_1 multiSelect ui maxheight dropdown inputwidth"></select>
                                    <select class="level_2 multiSelect ui maxheight dropdown inputwidth"></select>
                                    <div class="ui left pointing basic red mini label none">请选择所在城市</div>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="gender">性别：</label>
                                </dt>
                                <dd class="inline fields">
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                            <input type="radio" name="gender" checked tabindex="0" class="hidden">
                                            <label>男</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                            <input type="radio" name="gender" tabindex="0" class="hidden">
                                            <label>女</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                            <input type="radio" name="gender" tabindex="0" class="hidden">
                                            <label>保密</label>
                                        </div>
                                    </div>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="birth">生日：</label>
                                </dt>
                                <dd>
                                    <div class="ui right icon small input">
                                        <input type="text" placeholder="请选择.." name="birth" class="inputwidth calendar">
                                        <i class="users icon"></i>
                                    </div>
                                    <div class="ui left pointing basic red mini label" style="display:none;">请选择生日。</div>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="jobs">职业：</label>
                                </dt>
                                <dd>
                                    <input type="text" name="jobs" placeholder="" class="inputwidth">
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="pages">个人主页：</label>
                                </dt>
                                <dd>
                                    <input type="text" name="pages" placeholder="http://">
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt class="middle-container">
                                    <label for="about" class="middle-content">关于自己：</label>
                                </dt>
                                <dd>
                                    <textarea type="text" name="about" rows="5" placeholder=""></textarea>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="email" class="middle-content">邮箱：</label>
                                </dt>
                                <dd>
                                    <span>1385642156@163.com<a href="javascript:void(0)">（修改）</a></span>
                                </dd>
                            </dl>
                            <dl class="field">
                                <dt>
                                    <label for="email" class="middle-content">收货地址：</label>
                                </dt>
                                <dd>
                                    <span>陕西省西安市碑林区互助路66号西部电力国际商务中心16楼西安昭泰文化传播有限公司<a href="javascript:void(0)">（修改）</a></span>
                                </dd>
                            </dl>
                            <dl class="field centeraligend">
                                <ul class="ui primary button mt15">提交</ul>
                            </dl>
                        </form>
                    </div>
                </div>
                <div class="avator">
                    <img id="user-new-avator" src="./images/avator_1.jpg" alt="我的头像">
                    <button class="ui basic button green mini fluid mt15 upload-avator">修改头像</button>
                </div>
                <div class="ui modal avator-modal">
                    <div class="ui top attached progress" id="updating-progress" style="display:none;">
                        <div class="bar"></div>
                    </div>
                    <i class="close icon"></i>
                    <div class="ui header">
                        <p class="sub-font-color ">请选择图片</p>
                    </div>
                    <div class="image content view-image">
                        <div style="position:absolute; top: 15px;">
                            <button class="ui primary button select-image"><i class="icon file image outline"></i>点击上传</button><em class="explanition sub-font-color">文件小于2M,支持JPG,JPEG,GIF,PNG格式。</em>
                        </div>
                        <div class="view-panel">
                        <img src="./images/avator_1.jpg" id="target" alt="[Jcrop Example]" />
                        </div>
                        <div class="ui active inverted dimmer" id="upload-loader">
                            <div class="ui text loader sub-font-color ">正在上传..</div>
                        </div>
                        <div id="preview-pane" class="preview-area">
                            <div class="area-item">
                                <div class="preview-container prev1">
                                    <img src="./images/avator_1.jpg" class="jcrop-preview" alt="Preview" />
                                </div>
                                <p class="tac sub-font-color mt15">150*150</p>
                            </div>
                            <div class="area-item">
                                <div class="preview-container prev2">
                                    <img src="./images/avator_1.jpg" class="jcrop-preview" alt="Preview" />
                                </div>
                                <p class="tac sub-font-color mt15">75*75</p>
                            </div>
                            <div class="area-item">
                                <div class="preview-container prev3">
                                    <img src="./images/avator_1.jpg" class="jcrop-preview" alt="Preview" />
                                </div>
                                <p class="tac sub-font-color mt15">50*50</p>
                            </div>
                        </div>
                        <div class="ui positive mini success-meaage speci-message">
                            <p class="sub-font-color">您上传的图片会自动生成三种尺寸，请注意小尺寸的头像是否清晰。</p>
                        </div>
                        <div class="ui positive mini compact success-meaage speci-message" style="display:none;">
                            <p class="sub-font-color">您的头像修改成功。</p>
                        </div>
                    </div>
                    <div class="actions">
                        <button id="uploadImg" class="ui primary right labled icon button">保存修改<i class="icon checkmark"></i></button>
                    </div>
                    <form id="fileupload-form">
                        <input id="upload" style="display: none;" type="file" name="upload" />
                    </form>
                </div>
            </div>
        </div>
    </div>
   <div class="u-footer">
    <ul class="u-footerlist cf">
        <li>
            <span class="f-nav">帮助中心</span>
            <a href="javascript:;">常见问题解答</a>
        </li>
        <li>
            <span class="f-nav">合作及洽谈</span>
            <a href="javascript:;">设计师招商</a>
            <a href="javascript:;">大宗采购</a>
            <a href="javascript:;">商务合作</a>
            <a href="javascript:;">商家入驻</a>
        </li>
        <li>
            <span class="f-nav">支付方式</span>
            <a href="javascript:;">3D钱包</a>
            <a href="javascript:;">银行卡及支付平台</a>
            <a href="javascript:;">对公账号</a>
        </li>
        <li>
            <span class="f-nav">售后服务</span>
            <a href="javascript:;">退款说明</a>
            <a href="javascript:;">维修服务</a>
            <a href="javascript:;">退货流程</a>
        </li>
        <li>
            <span class="f-nav">客服中心</span>
            <a href="javascript:;">联系在线客服</a>
            <a href="javascript:;">留言板留言</a>
            <a href="javascript:;">会员信息修改</a>
            <a href="javascript:;">商家登录</a>
        </li>
        <li>
            <span class="f-nav">关于我们</span>
            <a href="javascript:;">关于喵呜</a>
            <a href="javascript:;">联系我们</a>
            <a href="javascript:;">加入3D</a>
        </li>
    </ul>
    <div class="copy">
        <p>
            <span class="c-box" ">
						<a href="javascript:; ">首页</a> | 
						<a href="javascript:; ">招聘英才</a> | 
						<a href="javascript:; ">合作及洽谈</a> | 
						<a href="javascript:; ">联系我们</a> |  
						<a  href="javascript:; ">关于我们</a>
					</span>
					<br />       	
					Copyright © 2007-2016 miaowu Inc.,All Rights Reserved.<br />
					陕ICP备14005701号
				</p>
		</div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/3.0.0/jquery.js"></script>
    <script src="../public/js/checkbox.min.js"></script>
    <script src="../public/js/transition.min.js"></script>
    <script src="../public/js/dropdown.min.js"></script>
    <script src="../public/js/api.min.js"></script>
    <script src="../public/js/dimmer.min.js"></script>
    <script src="../public/js/progress.min.js"></script>
    <script src="../public/js/modal.min.js"></script>
    <!--  Plugin flatpickr MultiLinkageSelect  -->
    <script src="../public/js/plug/flatpickr.js"></script>
    <script src="../public/js/plug/location.js"></script>
    <script src="../public/js/plug/LinkageSelect.js"></script>
    <!--  Plugin flatpickr MultiLinkageSelect  /-->
    <!-- select imagearea upload avator begin /-->
    <script src="../public/js/plug/jquery.Jcrop.min.js"></script>
    <script src="../public/js/plug/jquery.form.js"></script>
    <!-- select imagearea upload avator ends /-->
    <script>
    $(function() {
        $('.checkbox').checkbox();
        flatpickr('.calendar');
        //选择地址 data来自于location
        var options = {
                data: data
            },
            cropParam = {
                x: 0,
                y: 0,
                w: 0,
                h: 0,
                img: "",
                oW: 0,
                oH: 0
            },
            sel = new LinkageSelect(options);
        sel.bind('#location_select .level_1');
        sel.bind('#location_select .level_2');
        $('#location_select select').change(function(event) {
            $('#location_select select').dropdown();
            if ($(this).parent('.multiSelect').next('.multiSelect').length > 0) {
                $(this).parent('.multiSelect').next().children('.text').text("清选择");
            }
        });
        $('#location_select select').dropdown();

        $(".upload-avator").click(function(event) {
            $('.avator-modal').modal('show');
        });
        $(".select-image").click(function() {
            $("#upload").click();
        });

        $('#fileupload-form').on('submit', (function(e) {
            e.preventDefault();
            //序列化表单   
            var serializeData = $(this).serialize();
            // var formData = new FormData(this);
            $(this).ajaxSubmit({
                type: 'POST',
                url: "handleupload.php",
                dataType: 'json',
                data: serializeData,
                //attention!!!   
                contentType: false,
                cache: false,
                processData: false,

                beforeSubmit: function() {
                    //上传图片之前的处理 
                    $('#updating-progress').show().progress({
                        percent: 0
                    });
                    $(".select-image.button").html('上传中..');
                    $("#upload-loader").css('display', 'block');
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    // 在这里控制进度条
                    $('#updating-progress').progress({
                        percent: percentComplete
                    });
                },
                success: function(data) {
                    $(".select-image.button").html("<i class='icon file image outline'></i>选择文件");
                    $("#upload-loader").css('display', 'none');
                    $('#updating-progress').progress({
                        percent: 0
                    }).hide();
                    // 在这里设置新的图片路径
                    $('.jcrop-holder>img,\
                    #target, \
                    .jcrop-holder>div>div>img,\
                    #preview-pane .preview-container>img').attr('src', './upload/' + data.pic);
                    cropParam.img = data.pic;
                    cropPrev();
                },
                error: function(data) {
                    alert(data.responseText);
                }
            });
        }));

        // 绑定文件选择事件，一旦文件改变 就让form提交
        $("#upload").on("change", function() {
            $(this).parent().submit();
        });

        // 剪裁完之后上传
        $("#uploadImg").click(function(event) {
            if (cropParam.w === 0 || cropParam.h === 0) {
                alert("请剪裁图片");
                return;
            }
            $.post("cropimage.php", {
                x: cropParam.x,
                y: cropParam.y,
                w: cropParam.w,
                h: cropParam.h,
                img: cropParam.img,
                option: 'crop'
            }, function(data, textStatus) {
                if (textStatus === "success") {
                    $(".speci-message").hide();
                    $(".speci-message").eq(1).show();
                    setTimeout(function() {
                        $('.avator-modal').modal('hide');
                        $('#user-new-avator').attr('src', data);
                    }, 1000);
                } else {
                    alert("抱歉，头像更改失败");
                }
            });
        });

        function cropPrev() {
            // 剪裁预览
            var jcrop_api,
                boundx,
                boundy,
                // Grab some information about the preview pane
                $preview = $('#preview-pane'),
                $pcnt1 = $('#preview-pane .prev1'),
                $pimg1 = $('#preview-pane .prev1 img'),
                xsize1 = $pcnt1.width(),
                ysize1 = $pcnt1.height(),
                $pcnt2 = $('#preview-pane .prev2'),
                $pimg2 = $('#preview-pane .prev2 img'),
                xsize2 = $pcnt2.width(),
                ysize2 = $pcnt2.height(),
                $pcnt3 = $('#preview-pane .prev3'),
                $pimg3 = $('#preview-pane .prev3 img'),
                xsize3 = $pcnt3.width(),
                ysize3 = $pcnt3.height();
            $('#target').Jcrop({
                onChange: updatePreview,
                onSelect: updatePreview,
                aspectRatio: 1 / 1,
                minSize: [100, 100]

            }, function() {
                // Use the API to get the real image size
                var bounds = this.getBounds();
                boundx = bounds[0];
                boundy = bounds[1];

                var img_url = $("#target").attr('src');
                // 创建对象
                var img = new Image();
                img.src = img_url;
                img.onload = function() {
                        cropParam.oW = img.width;
                        cropParam.oH = img.height;
                    }
                    // Store the API in the jcrop_api variable
                jcrop_api = this;
                $preview.appendTo(jcrop_api.ui.holder);
            });

            function updatePreview(c) {
                if (parseInt(c.w) > 0) {
                    cropParam.x = c.x;
                    cropParam.y = c.y;
                    cropParam.w = c.w;
                    cropParam.h = c.h;
                    // if (cropParam.oW >= 480) {
                    //     cropParam.x = c.x * (cropParam.oW / 480);
                    //     cropParam.w = c.w * (cropParam.oW / 480);
                    // }
                    // if (cropParam.oH >= 480) {
                    //     cropParam.y = c.y * (cropParam.oH / 480);
                    //     cropParam.h = c.h * (cropParam.oH / 480);
                    // }
                    var rx1 = xsize1 / c.w;
                    var ry1 = ysize1 / c.h;
                    var rx2 = xsize2 / c.w;
                    var ry2 = ysize2 / c.h;
                    var rx3 = xsize3 / c.w;
                    var ry3 = ysize3 / c.h;
                    $pimg1.css({
                        width: Math.round(rx1 * boundx) + 'px',
                        height: Math.round(ry1 * boundy) + 'px',
                        marginLeft: '-' + Math.round(rx1 * c.x) + 'px',
                        marginTop: '-' + Math.round(ry1 * c.y) + 'px'
                    });
                    $pimg2.css({
                        width: Math.round(rx2 * boundx) + 'px',
                        height: Math.round(ry2 * boundy) + 'px',
                        marginLeft: '-' + Math.round(rx2 * c.x) + 'px',
                        marginTop: '-' + Math.round(ry2 * c.y) + 'px'
                    });
                    $pimg3.css({
                        width: Math.round(rx3 * boundx) + 'px',
                        height: Math.round(ry3 * boundy) + 'px',
                        marginLeft: '-' + Math.round(rx3 * c.x) + 'px',
                        marginTop: '-' + Math.round(ry3 * c.y) + 'px'
                    });
                }
            };
        }
    });
    </script>
</body>

</html>
